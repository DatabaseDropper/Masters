@using OnlineJudge.Models.IO
@model CodeEditorParams

<div id="CodeEditor">
    <form>
        <select name="lang" id="lang">
            @foreach (var lang in Model.AvailableLanguages)
            {
                <option value="@lang">@lang</option>
            }
        </select>
        <br />
        <textarea name="code" id="code" placeholder="Paste your code here..."></textarea>
        @if (User.Identity.IsAuthenticated)
        {
            <div id="upload_btn">
                <button type="button" class="btn btn-success" onclick="SendCode()">Submit your code</button>
            </div>
        }
        else
        {
            <div id="upload_btn">
                <a class="btn btn-success" href="/Account/SignIn">Sign In</a>
            </div>
        }
    </form>
</div>

<style>
    #code
    {
        width: 100%;
        height: 500px;
    }

    #upload_btn
    {
        display: flex;
        justify-content:flex-end
    }
</style>

<script>
    function SendCode() {
        var lang = document.getElementById("lang").value;
        var code = document.getElementById("code").value;

        let data = { Language: lang, Code: code, AssignmentId: '@Model.TaskId' };

        fetch("/Code/Submission/", 
        {
            method: "POST",
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        })
        .then(res => 
        {
            console.log("Request complete! response:", res);
        });
    }
</script>